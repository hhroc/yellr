"use strict";var yellr=yellr||{};yellr.BASE_URL="/",yellr.AUTO_REFRESH=!0,window.onload=function(){if(!Handlebars||!$)return void console.log("missing dependencies for yellr.utils.render_template");var a,b,c;switch(null===localStorage.getItem("yellr-mod")?yellr.utils.redirect_to_login():yellr.utils.load_localStorage(),void 0===yellr.DATA&&(yellr.DATA={}),a=document.querySelector("body"),b=a.getAttribute("data-page")){case"index":yellr.view.index.init();break;case"login":yellr.view.login();break;case"create-assignment":yellr.view.create_assignment();break;case"assignments":yellr.view.all_assignments();break;case"single-assignment":yellr.view.view_assignment.init();break;case"write-article":yellr.view.write_article();break;case"collections":yellr.view.all_collections();break;case"single-collection":yellr.view.view_collection();break;case"messages":yellr.view.inbox();break;default:console.log("lol ok")}c=document.querySelector("#sidebar"),c&&(document.querySelector("#logout-btn").onclick=function(){yellr.utils.logout()},a.scrollHeight>c.scrollHeight&&c.setAttribute("style","min-height: "+a.scrollHeight+"px"))};var mod=mod||{};mod.feed={toggle_collections_dropdown:function(a){$(a.parentNode).hasClass("dropdown-container")?mod.feed.hide_collections_dropdown(a):mod.feed.show_collections_dropdown(a)},show_collections_dropdown:function(a){$(a.parentNode).addClass("dropdown-container"),mod.utils.render_template({template:"#collections-dropdown-template",target:a.parentNode,context:{collections:mod.DATA.collections},append:!0}),$(a.parentNode).find(".collections-dropdown").on("click",function(a){mod.feed.add_post_to_collection_from_feed(a.target)})},hide_collections_dropdown:function(a){$(a.parentNode).removeClass("dropdown-container"),mod.utils.render_template({template:"",target:$(a.parentNode).find(".collections-dropdown")})},add_post_to_collection_from_feed:function(a){var b=$(a.offsetParent.offsetParent.parentNode.parentNode.parentNode),c=b.find(".meta-div").data("post-id"),d=$(a).data("collection-id");mod.collections.add_post_to_collection(c,d,function(b){b&&(a.parentNode.style.opacity="0.3")})},settings:{source_type:"all",media_types:["video","photo","audio","text"],text:""},init:function(a){moderator.submissions_grid=a.grid.querySelectorAll(".story-item");var b=document.querySelector(".filter-form");b.querySelector("#filter-submission-type").onclick=this.submission_type,b.querySelector("#filter-content-type").onclick=this.content_type,b.querySelector("#filter-search").onkeyup=this.search},submission_type:function(a){"INPUT"==a.target.tagName&&(moderator.filter.settings.source_type=a.target.value,moderator.filter.grid({array:moderator.submissions_grid,settings:moderator.filter.settings}))},content_type:function(a){if("INPUT"==a.target.tagName){for(var b=[],c=a.target.parentNode.parentNode,d=c.querySelectorAll('input[type="checkbox"]'),e=0;e<d.length;e++){var f=d[e];f.checked&&b.push(f.value)}moderator.filter.settings.media_types=b,moderator.filter.grid({array:moderator.submissions_grid,settings:moderator.filter.settings})}},search:function(a){moderator.filter.settings.text=a.target.value.toLowerCase(),moderator.filter.grid({array:moderator.submissions_grid,settings:moderator.filter.settings})},grid:function(a){for(var b=0;b<a.array.length;b++){var c=a.array[b],d=c.querySelector(".meta-div"),e=c.className;c.className=e.split("filtered-out")[0],"all"!==a.settings.source_type&&d.getAttribute("data-source")!==a.settings.source_type&&(c.className+=" filtered-out");for(var f=d.getAttribute("data-type"),g=!1,h=0;h<a.settings.media_types.length;h++){var i=a.settings.media_types[h];if(f==i){g=!0;break}}g||(c.className+=" filtered-out");var j=new RegExp(moderator.filter.settings.text),k=c.querySelector(".description").innerHTML.toLowerCase();k.search(j)&&(c.className+=" filtered-out")}moderator.packery.reloadItems();for(var l=document.querySelectorAll(".filtered-out"),h=0;h<l.length;h++)moderator.packery.remove(l[h].parentNode);moderator.packery.layout()}};var yellr=yellr||{};yellr.server={login:function(a,b,c){var d=yellr.BASE_URL+"admin/get_access_token.json?user_name="+a+"&password="+b;$.ajax({type:"POST",url:d,dataType:"json",success:function(a){c&&c(a),a.success&&(yellr.TOKEN=a.token,yellr.utils.save(),yellr.utils.set_urls(),yellr.server.get_languages(function(a){a.success&&yellr.utils.redirect_to("index.html")}))}})},get_languages:function(a){$.ajax({url:yellr.URLS.get_languages,type:"POST",dataType:"json",success:function(b){b.success?(yellr.DATA.languages=b.languages,yellr.utils.save(),a&&a(b)):yellr.utils.redirect_to_login()}})},create_question:function(a,b){a.answers&&(a.answers=JSON.stringify(a.answers)),$.ajax({type:"POST",url:yellr.URLS.create_question,data:a,dataType:"json",success:function(a){a.success&&b&&b(a)}})},publish_assignment:function(a,b){a.questions=JSON.stringify(a.questions),$.ajax({type:"POST",url:yellr.URLS.publish_assignment,data:a,dataType:"json",success:function(a){console.log(a),a.success?b&&b(a):alert("Something went wrong submitting an Assignment")},error:function(a){console.log("ERR_RRORRERIRIRIR"),console.log(a)}})},create_collection:function(a,b){$.ajax({url:yellr.URLS.create_collection,type:"POST",dataType:"json",data:a,success:function(a){a.success?b&&b():console.log("something went wrong creating a collection for this assignment")}})},get_posts:function(a){var b=!1,c=[];$.getJSON(yellr.URLS.get_posts,function(a){a.success?(b=!0,c=yellr.utils.convert_object_to_array(a.posts),yellr.DATA.posts=c,yellr.utils.save()):yellr.utils.notify("Something went wrong loading posts.")}).done(function(){b&&a(c)}).fail(function(){yellr.utils.redirect_to_login()})},get_my_assignments:function(a){var b,c=!1;$.getJSON(yellr.URLS.get_my_assignments,function(a){a.success?(c=!0,b=yellr.utils.convert_object_to_array(a.assignments),yellr.DATA.assignments=b,yellr.utils.save()):console.log("something went wrong loading get_my_assignments")}).done(function(){c&&a(b)}).fail(function(){yellr.utils.redirect_to_login()})},get_responses_for:function(a,b){var c,d=!1;$.ajax({url:yellr.URLS.get_assignment_responses+"&assignment_id="+a.toString(),type:"POST",dataType:"json",success:function(a){a.success&&(d=!0,c=a.posts)}}).done(function(){d&&b(c)}).fail(function(){yellr.utils.redirect_to_login()})},get_collection:function(a,b){$.getJSON(yellr.URLS.get_collection_posts,{collection_id:a},function(a){a.success&&b({collection:yellr.utils.convert_object_to_array(a.posts),collection_name:a.collection_name})}).fail(function(){yellr.utils.redirect_to_login()})},get_my_collections:function(a){$.getJSON(yellr.URLS.get_my_collections,function(a){a.success?(yellr.DATA.collections=a.collections,yellr.utils.save()):console.log("something went wrong getting your collections")}).done(function(){a&&a()}).fail(function(){yellr.utils.redirect_to_login()})},add_post_to_collection:function(a,b,c){var d=!1;$.post(yellr.URLS.add_post_to_collection,{post_id:a,collection_id:b},function(a){a.success&&(d=!0,c&&c(d))}).fail(function(){return console.log("something went wrong adding the post to the collection"),d})},get_messages:function(a){$.getJSON(yellr.URLS.get_my_messages,function(a){a.success?yellr.DATA.messages=a.messages:yellr.utils.notify("Could not load new messages.")}).done(function(){a&&a()}).fail(function(){yellr.utils.redirect_to_login()})},send_message:function(a,b,c,d,e){var f={subject:a,text:b,to_client_id:c};e&&(f.parent_message_id=e),$.ajax({type:"POST",url:yellr.URLS.create_message,dataType:"json",data:f,success:function(a){a.success?(yellr.utils.notify("Message sent!"),d&&d(a)):yellr.utils.notify("Error sending message. Check the user ID.")}})},publish_story:function(a,b){$.post(yellr.URLS.publish_story,a,function(a){a.success?b&&b(a):yellr.utils.notify("something went wrong")})}};var yellr=yellr||{};yellr.utils={get_hash:function(){return window.location.hash.split("#")[1]},convert_object_to_array:function(a){var b=[];for(var c in a)b.push(a[c]);return b},notify:function(a){console.log(a)},redirect_to:function(a){var b="/moderator/";window.location.replace(b+a)},redirect_to_login:function(){"login"!==document.querySelector("body").getAttribute("data-page")&&yellr.utils.redirect_to("login.html")},logout:function(){localStorage.removeItem("yellr-mod"),yellr.utils.redirect_to_login("You have been logged out")},load_localStorage:function(){var a=JSON.parse(localStorage.getItem("yellr-mod"));yellr.DATA=a.DATA,yellr.SETTINGS=a.SETTINGS,yellr.TOKEN=a.TOKEN,yellr.URLS=a.URLS},load:function(a){void 0===yellr.DATA&&(yellr.DATA={}),$.getJSON(yellr.URLS[a.data],function(b){if(b.success){if(a.saveAs){if(Array.isArray(b[a.saveAs])===!1){var c=[];for(var d in b.posts)c.push(b.posts[d]);yellr.DATA[a.saveAs]=c}else yellr.DATA[a.saveAs]=b[a.saveAs];"posts"===a.saveAs&&yellr.DATA.posts.reverse(),yellr.utils.save()}a.callback&&a.callback(b)}else console.log(b),console.log(yellr.URLS[a.data]),console.log("Something went wrong loading: "+a.data+"\nThis could be because your previous session has expired. Please log back in")})},save:function(){localStorage.setItem("yellr-mod",JSON.stringify({DATA:yellr.DATA,SETTINGS:yellr.SETTINGS,TOKEN:yellr.TOKEN,URLS:yellr.URLS}))},set_urls:function(){var a=yellr.BASE_URL+"admin/";yellr.URLS={get_posts:a+"get_posts.json?token="+yellr.TOKEN,get_my_messages:a+"get_my_messages.json?token="+yellr.TOKEN,create_message:a+"create_message.json?token="+yellr.TOKEN,create_question:a+"create_question.json?token="+yellr.TOKEN,get_my_assignments:a+"get_my_assignments.json?token="+yellr.TOKEN,publish_assignment:a+"publish_assignment.json?token="+yellr.TOKEN,update_assignment:a+"update_assignment.json?token="+yellr.TOKEN,get_assignment_responses:a+"get_assignment_responses.json?token="+yellr.TOKEN,create_collection:a+"create_collection.json?token="+yellr.TOKEN,get_my_collections:a+"get_my_collections.json?token="+yellr.TOKEN,disable_collection:a+"disable_collection.json?token="+yellr.TOKEN,add_post_to_collection:a+"add_post_to_collection.json?token="+yellr.TOKEN,remove_post_from_collection:a+"remove_post_from_collection.json?token="+yellr.TOKEN,get_collection_posts:a+"get_collection_posts.json?token="+yellr.TOKEN,get_languages:a+"get_languages.json?token="+yellr.TOKEN,get_question_types:a+"get_question_types.json?token="+yellr.TOKEN,create_user:a+"create_user.json?token="+yellr.TOKEN,publish_story:a+"publish_story.json?token="+yellr.TOKEN,upload:yellr.BASE_URL+"upload_media.json"},yellr.utils.save()},show_overlay:function(a){var b=document.querySelector("#overlay-div-container");b.className="active",b.onclick=yellr.utils.clear_overlay,a&&this.render_template({template:a.template,context:a.context,target:b})},clear_overlay:function(a){if(void 0===a||"overlay-div-container"===a.target.id){var b=document.querySelector("#overlay-div-container");return b.className="",void b.removeEventListener("click",yellr.utils.clear_overlay,!1)}},render_template:function(a){if(!a.template||""===a.template)return void $(a.target).html("");var b=Handlebars.compile($(a.template).html()),c=b(a.context?a.context:{});a.append?$(a.target).append(c):a.prepend?$(a.target).prepend(c):$(a.target).html(c)}};var yellr=yellr||{};yellr.view=yellr.view||{},yellr.view.all_assignments=function(){yellr.server.get_my_assignments(function(){var a=yellr.DATA.assignments.filter(function(a){return a.title=a.questions[0].question_text,a.expire_datetime=moment(a.expire_datetime).format("MMM Do YYYY"),a.url="view-assignment.html#"+a.assignment_id,!0});yellr.utils.render_template({template:"#my-assignment-li",target:".my-assignments-list",context:{assignments:a}})})};var yellr=yellr||{};yellr.view=yellr.view||{},yellr.view.all_collections=function(){yellr.server.get_my_collections(function(){var a=yellr.DATA.collections.filter(function(a){return a.collection_datetime=moment(a.collection_datetime).format("MMM Do YYYY"),a.url="view-collection.html#"+a.collection_id,!0});yellr.utils.render_template({template:"#collections-gi-template",target:".collections-grid",context:{collections:a}})}),document.querySelector("#new-collection-btn").onclick=function(){yellr.utils.show_overlay({template:"#collections-form-template"}),yellr.collections.setup_form()},document.querySelector("#delete-collection-btn").onclick=function(){console.log("delete collection")}};var yellr=yellr||{};yellr.view=yellr.view||{},yellr.view.create_assignment=function(){document.querySelector("#language-select").onchange=function(){if("--"!==this.value){yellr.utils.render_template({template:"#question-form-template",target:".question-container",context:{language:this.value,language_code:this.value.toLowerCase().substring(0,2)},append:!0});for(var a=0;a<this.options.length;a++)this.options[a].value===this.value&&(this.removeChild(this.options[a]),1===this.options.length&&document.querySelector("#questions-container").removeChild(document.querySelector(".language-select-wrapper")))}},document.querySelector("#survey-input").onkeypress=function(a){if(13===a.keyCode&&(a.preventDefault(),""!==this.value)){var b=document.querySelectorAll("#survey-answers-list li");1===b.length&&"None."===b[0].innerHTML&&b[0].parentNode.removeChild(b[0]),8!==b?(yellr.utils.render_template({template:"#new-survey-answer-template",target:"#survey-answers-list",context:{answer:this.value},append:!0}),this.value=""):yellr.utils.notify("Max of 8 answers allowed.")}},document.querySelector("#image-upload").onclick=function(){console.log("hello from: "),$("#image-input").ajaxSubmit({url:yellr.URLS.upload,data:{client_id:yellr.TOKEN,media_type:"image"},success:function(a){console.log(a),console.log(a.success?"photo uploaded":"something went wrong")}})},document.querySelector("#assignment-tabs").onclick=function(a){var b=document.querySelector("#assignment-tabs .current");b&&(b.className=b.className.replace("current","")),a.target.className+=" current"},document.querySelector("#preview-btn").onclick=function(){var a=document.querySelector(".question-container form"),b=a.querySelector(".question_text").value,c=a.querySelector(".question_description").value;""===b&&(b="[Empty]");var d=document.querySelector("#preview");d.querySelector(".preview-title").innerHTML=b,d.querySelector(".preview-description").innerHTML=c},document.querySelector("#post-btn").onclick=function(){for(var a=document.querySelectorAll(".question-container form"),b=document.querySelectorAll("#assignment-question-type input"),c=document.querySelectorAll("#survey-answers-list li"),d=document.querySelector("#lifetime").value,e=document.querySelector("#unit-of-time-list input:checked").value,f=[],g=[],h={},i="days"===e?24:720,j=0;j<a.length;j++){for(var k={language_code:a[j].querySelector("input").value,question_text:a[j].querySelector(".question_text").value,description:a[j].querySelector(".question_description").value},l=0;l<b.length;l++)b[l].checked&&(k.question_type=b[l].value);if("multiple_choice"===k.question_type){for(var m=0;m<c.length;m++)g.push(c[m]);k.answers=g}yellr.server.create_question(k,function(b){f.push(b.question_id),f.length===a.length&&(h.life_time=d*i,h.questions=f,h.top_left_lat=43.4,h.top_left_lng=-77.9,h.bottom_right_lat=43,h.bottom_right_lng=-77.3,yellr.server.publish_assignment(h,function(a){yellr.server.create_collection({name:"Assignment #"+a.assignment_id+" Collection",description:"Collection for #"+a.assignment_id,tags:"some, example, collection tags"},function(){yellr.server.get_my_assignments(function(){yellr.utils.redirect_to("view-assignment.html#"+a.assignment_id)})})}))})}}};var yellr=yellr||{};yellr.view=yellr.view||{},yellr.view.inbox=function(){$.getJSON(args.data_url,function(a){raw_data=a.messages,self.render()});var a=template({messages:raw_data});$(unread_target).html(a),$(read_target).html(a),yellr.server.get_messages(function(){}),document.querySelector("#inbox").onclick=function(a){var b="LI"===a.target.nodeName?a.target.getAttribute("data-id"):a.target.parentNode.getAttribute("data-id"),c=yellr.DATA.messages.filter(function(a){return a.message_id===parseInt(b)?!0:void 0})[0];yellr.utils.show_overlay({template:"#view-message-template",context:c})}};var yellr=yellr||{};yellr.view=yellr.view||{},yellr.view.index={timeout:void 0,pckry:void 0,current_class:"feed-gi",change_grid_classes_to:function(a){for(var b=document.querySelectorAll("."+yellr.view.index.current_class),c=0;c<b.length;c++)b[c].className=a;yellr.view.index.current_class="gi"},init:function(){var a=document.querySelector("#raw-feed"),b=[];yellr.server.get_my_assignments(function(a){for(var c=0;c<a.length&&(b.push(a[c]),!(b.length>=4));c++);b.filter(function(a){a.expire_datetime=moment(a.expire_datetime).fromNow(!0)}),yellr.utils.render_template({template:"#active-assignment-template",target:"#active-assignments-list",context:{assignments:b}})}),yellr.server.get_posts(function(){for(var b=yellr.DATA.posts.reverse(),c=0;c<b.length;c++)b[c].class=yellr.view.index.current_class;yellr.utils.render_template({template:"#raw-feed-item",target:"#raw-feed",context:{posts:b},prepend:!0}),setTimeout(function(){yellr.view.index.pckry=new Packery(a,{itemSelector:".feed-gi",columnWidth:".feed-sizer",gutter:".feed-gutter"})},1e3)}),document.querySelector("#feed-view").onclick=function(b){b.target.checked&&("list"===b.target.value?(yellr.view.index.change_grid_classes_to("gi"),yellr.view.index.pckry.destroy()):(yellr.view.index.change_grid_classes_to("feed-gi"),yellr.view.index.pckry=new Packery(a,{itemSelector:".feed-gi",columnWidth:".feed-sizer",gutter:".feed-gutter"})))},document.querySelector("#auto-update").onclick=function(a){yellr.AUTO_REFRESH=a.target.checked===!0?!0:!1,yellr.view.index.refresh()},document.querySelector(".feed-filter-div").onclick=function(){console.log("hello from: ")},a.onclick=function(a){switch(a.target.className){case"fa fa-folder":yellr.feed.toggle_collections_dropdown(a.target);break;case"fa fa-comment":var b=a.target.offsetParent.querySelector(".meta-div"),c=parseInt(b.getAttribute("data-post-id")),d=yellr.DATA.posts.filter(function(a){return a.post_id===c?!0:void 0})[0];yellr.utils.show_overlay({template:"#send-message-template",context:{uid:d.client_id,subject:"RE: "+d.title}});var e=$("#send-message-form");e.submit(function(a){a.preventDefault();var b=e.serializeArray();yellr.messages.send_message({to:b[0],subject:b[1],text:b[2],callback:function(){yellr.utils.clear_overlay()}})});break;case"fa fa-flag":console.log("report the motherfucker")}},yellr.AUTO_REFRESH&&this.refresh()},refresh:function(a){return yellr.AUTO_REFRESH?void(yellr.view.index.timeout=setTimeout(function(){yellr.server.get_posts(function(){var a=document.querySelectorAll("."+yellr.view.index.current_class).length,b=[];if(yellr.DATA.posts.length>a){for(var c=a;c<yellr.DATA.posts.length;c++)b.push(yellr.DATA.posts[c].class=yellr.view.index.current_class);yellr.utils.render_template({template:"#raw-feed-item",target:"#raw-feed",context:{posts:b},prepend:!0}),setTimeout(function(){yellr.view.index.pckry.reloadItems(),yellr.view.index.pckry.layout()},1e3)}}),yellr.view.index.refresh(a)},3e3)):void window.clearTimeout(yellr.view.index.timeout)}};var yellr=yellr||{};yellr.view=yellr.view||{},yellr.view.login=function(){document.querySelector("#mod-login").onsubmit=function(a){a.preventDefault(),yellr.server.login(this.elements.user_name.value,this.elements.password.value,function(a){a.success||(document.querySelector("#login-feedback").innerHTML=a.error_text)})}};var yellr=yellr||{};yellr.view=yellr.view||{},yellr.view.view_assignment=function(){var a,b,c=[],d=[],e=[],f=0,g=!0,h=3,i=function(f){if(b=f?f:parseInt(window.location.hash.split("#")[1]),0/0!==b){d=yellr.DATA.assignments.filter(function(a){return a.assignment_id===b?!0:void 0})[0],a=d.assignment_id,yellr.utils.render_template({template:"#assignment-overview-template",target:"#view-assignment-section",context:{assignment:d}});var g=document.querySelector(".assignment-deadline");g.innerHTML=moment(g.innerHTML).format("MMMM Do YYYY");var h=document.querySelector(".assignment-published");h.innerHTML=moment(h.innerHTML).format("MMMM Do YYYY"),yellr.server.get_collection(a,function(a){console.log(a.collection),c=a.collection,yellr.utils.render_template({template:"#collections-li-template",target:"#assignment-collection-list",context:{collection:a.collection}}),yellr.server.get_responses_for(b,function(a){console.log(a);var b=yellr.utils.convert_object_to_array(a);yellr.view.view_assignment.total_posts=b.length,e=j(b),yellr.utils.render_template({template:"#assignment-response-li-template",target:"#assignment-replies-list",context:{replies:e}})})}),document.querySelector("#assignment-replies-list").onclick=function(b){if("I"===b.target.nodeName){var d=b.target.parentNode.getAttribute("data-action");switch(d){case"add":var e=parseInt(b.target.parentNode.parentNode.parentNode.querySelector(".meta-div").getAttribute("data-post-id"));yellr.server.add_post_to_collection(e,a,function(d){if(d){yellr.utils.notify("Post added to collection");var e=b.target.parentNode.parentNode.parentNode.parentNode.parentNode;e.parentNode.removeChild(e),yellr.server.get_collection(a,function(a){c=a.collection,yellr.utils.render_template({template:"#collections-li-template",target:"#assignment-collection-list",context:{collection:a.collection}})})}});break;case"feedback":console.log("leave a message");break;case"flag":console.log("flag as innappropriate");break;case"remove":console.log("remove")}}},document.querySelector("#auto-reload").onclick=function(a){a.target.checked?(console.log("toggle reload"),yellr.view.view_assignment.auto_refresh=!0,yellr.view.view_assignment.loop()):(yellr.view.view_assignment.auto_refresh=!1,yellr.view.view_assignment.loop())},yellr.view.view_assignment.loop()}},j=function(a){for(var b=[],d=0;d<a.length;d++){for(var e=!0,f=a[d],g=0;g<c.length;g++)f.post_id===c[g].post_id&&(e=!1);e&&b.push(f)}return b},k=function(a){var a=a;yellr.view.view_assignment.auto_refresh?a=setTimeout(function(){yellr.server.get_responses_for(b,function(a){var b=yellr.utils.convert_object_to_array(a);b.length>yellr.view.view_assignment.total_posts&&(console.log("new posts"),yellr.view.view_assignment.total_posts=b.length,e=j(b),yellr.utils.render_template({template:"#assignment-response-li-template",target:"#assignment-replies-list",context:{replies:e}}))}),yellr.view.view_assignment.loop(a)},1e3*h):window.clearTimeout(a)};return{init:i,loop:k,auto_refresh:g,total_posts:f,filter_for_new_responses:j}}();var yellr=yellr||{};yellr.view=yellr.view||{},yellr.view.view_collection=function(){var a,b,c,d,e=[],f=0;f=parseInt(window.location.hash.split("#")[1]),yellr.server.get_collection(f,function(a){document.querySelector(".t1").innerHTML=a.collection_name,yellr.utils.render_template({template:"#view-collection-gi-template",target:"#collection-wrapper",context:{collection:a.collection},append:!0}),e=document.querySelectorAll(".collection-gi"),setTimeout(function(){d=new Packery(c,{itemSelector:".collection-gi",columnWidth:".collection-grid-sizer",gutter:".gutter-sizer"})},500)}),c=document.querySelector("#collection-wrapper"),c.onclick=function(a){"fa fa-comment"===a.target.className?alert("Send message"):"fa fa-close"===a.target.className&&alert("Remove item from collection")},b=document.querySelector("#export-content-btn"),b.onclick=function(){alert("TODO: Download zip file of media collection")},a=document.querySelector(".collection-view-controls"),a.onclick=function(a){if(a.target.checked)if("list"===a.target.defaultValue){d.destroy();for(var b=0;b<e.length;b++)e[b].className="gi"}else{for(var b=0;b<e.length;b++)e[b].className="collection-gi";d=new Packery(c,{itemSelector:".collection-gi",columnWidth:".collection-grid-sizer",gutter:".gutter-sizer"})}}};var yellr=yellr||{};yellr.view=yellr.view||{},yellr.view.write_article=function(){var a=window.location.hash.split("#")[1];void 0!==a?(a=parseInt(a),yellr.server.get_collection(a,function(a){yellr.utils.render_template({template:"#collections-li-template",target:"#write-article-collection-list",context:{collection:a.collection}})})):yellr.utils.render_template({template:"#collections-li-template",target:"#write-article-collection-list",context:{collection:void 0}}),yellr.server.get_my_collections(function(){var a=yellr.DATA.collections;a.unshift({collection_id:"",name:"--"}),yellr.utils.render_template({template:"#collections-option-template",target:"#collection-select",context:{collections:a}})}),document.querySelector("#collection-select").onchange=function(){""!==this.value&&yellr.server.get_collection(parseInt(this.value),function(a){yellr.utils.render_template({template:"#collections-li-template",target:"#write-article-collection-list",context:{collection:a.collection}}),document.querySelector("#collection-name").innerHTML=a.collection_name})},document.querySelector("#post-btn").onclick=function(){var a={},b=document.querySelector("#article-title"),c=document.querySelector("#article-tags"),d=document.querySelector("#article-body"),e=document.querySelector("#article-leadin");a.title=b.value,a.banner_media_id="",a.tags=c.value,a.contents=d.value,a.top_text=e.value,a.language_code="en",a.top_left_lat=43.4,a.top_left_lng=-77.9,a.bottom_right_lat=43,a.bottom_right_lng=-77.3,yellr.server.publish_story(a,function(a){b.value="",c.value="",c.value="",d.value="",e.value="";var f="/story?id="+a.story_unique_id;window.open(f,"_blank"),alert("Article has been posted! \n"+f),yellr.utils.notify("Article has been posted! \n"+f)})},document.querySelector("#article-body").ondrop=function(a){console.log(a);var b=a.dataTransfer.getData("text/x-media");console.log(b)},document.querySelector("#write-article-collection-list").ondragstart=function(a){console.log("dragstart"),console.log(a.target.dataset.media)}};